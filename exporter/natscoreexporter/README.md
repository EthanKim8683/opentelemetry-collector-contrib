# NATS Core Exporter

<!-- status autogenerated section -->
<!-- end autogenerated section -->

NATS Core exporter exports logs, metrics and traces to [NATS Core](https://docs.nats.io/).

## Configuration

The following configuration options are supported:

- `endpoint` (default = nats://localhost:4222): The NATS server URL.
- `tls`: See [TLS Configuration Settings](https://github.com/open-telemetry/opentelemetry-collector/blob/main/config/configtls/README.md) for the full set of available options.
- `logs`
  - `subject` (default = otel_logs): The [text/template](https://pkg.go.dev/text/template) template string used to construct NATS subjects for logs.
  - `marshaler` (default = otlp_proto): The name of the marshaler used to marshal logs. See [Supported Marshalers](#supported-marshalers).
  - `encoder`: The name of the encoding extension used to marshal logs. This configuration option is mutually exclusive with `marshaler`. See [Encoding extensions](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/extension/encoding/README.md).
- `metrics`
  - `subject` (default = otel_metrics): The [text/template](https://pkg.go.dev/text/template) template string used to construct NATS subjects for metrics.
  - `marshaler` (default = otlp_proto): The name of the marshaler used to marshal metrics. See [Supported Marshalers](#supported-marshalers).
  - `encoder`: The name of the encoding extension used to marshal metrics. This configuration option is mutually exclusive with `marshaler`. See [Encoding extensions](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/extension/encoding/README.md).
- `traces`
  - `subject` (default = otel_traces): The [text/template](https://pkg.go.dev/text/template) template string used to construct NATS subjects for traces.
  - `marshaler` (default = otlp_proto): The name of the marshaler used to marshal traces. See [Supported Marshalers](#supported-marshalers).
  - `encoder`: The name of the encoding extension used to marshal traces. This configuration option is mutually exclusive with `marshaler`. See [Encoding extensions](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/extension/encoding/README.md).
- `auth`

  - `token`: Configuration options for [token auth](https://docs.nats.io/running-a-nats-service/configuration/securing_nats/auth_intro/tokens).
    - `token`: The plaintext token.
  - `user_info`: Configuration options for [username/password auth](https://docs.nats.io/running-a-nats-service/configuration/securing_nats/auth_intro/username_password).
    - `user`: The username.
    - `password`: The password.
  - `nkey`: Configuration options for [NKey auth](https://docs.nats.io/running-a-nats-service/configuration/securing_nats/auth_intro/nkey_auth).
    - `pub_key`: The public key.
    - `sig_key`: The private/signing key.
  - `user_jwt`: Configuration options for [decentralized NKey auth via JWT](https://docs.nats.io/running-a-nats-service/configuration/securing_nats/auth_intro/jwt).
    - `jwt`: The JWT.
    - `sig_key`: The private/signing key.
  - `user_credentials`: Configuration options for [decentralized NKey auth via credentials file](https://docs.nats.io/using-nats/developer/connecting/creds).
    - `user_file`: The path to the user file.

### Supported marshalers

NATS Core exporter supports marshalers for the following built-in encodings:

- `otlp_proto`: Signals are encoded as OTLP Protobuf.
- `otlp_json`: Signals are encoded as OTLP JSON.
- `log_body`: Log bodies are extracted from logs and plaintext encoded. **This marshaler is only supported for logs.**

## Example Configurations

### Dynamic subjects

Messages in NATS are selectively consumed using [subject-based filtering](https://docs.nats.io/nats-concepts/subjects#subject-based-filtering-and-security). To support this model, NATS Core exporter constructs dynamic subjects using [text/template](https://pkg.go.dev/text/template) template strings.

Below is an example of dynamic subjects for traces, where the configured template will be executed on a [`Span`](https://pkg.go.dev/go.opentelemetry.io/collector/pdata/internal/data/protogen/trace/v1#Span):

```yaml
natscoreexporter:
  traces:
    subject: "otel.traces.{{ .TraceID }}.spans.{{ .SpanID }}"
```
