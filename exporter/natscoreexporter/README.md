# NATS Core Exporter

<!-- status autogenerated section -->
| Status        |           |
| ------------- |-----------|
| Stability     | [development]: metrics, logs, traces   |
| Distributions | [contrib] |
| Issues        | [![Open issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aopen%20label%3Aexporter%2Fnatscore%20&label=open&color=orange&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aopen+is%3Aissue+label%3Aexporter%2Fnatscore) [![Closed issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aclosed%20label%3Aexporter%2Fnatscore%20&label=closed&color=blue&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aclosed+is%3Aissue+label%3Aexporter%2Fnatscore) |
| Code coverage | [![codecov](https://codecov.io/github/open-telemetry/opentelemetry-collector-contrib/graph/main/badge.svg?component=exporter_natscore)](https://app.codecov.io/gh/open-telemetry/opentelemetry-collector-contrib/tree/main/?components%5B0%5D=exporter_natscore&displayType=list) |
| [Code Owners](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/CONTRIBUTING.md#becoming-a-code-owner)    | [@EthanKim8683](https://www.github.com/EthanKim8683) |

[development]: https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/component-stability.md#development
[contrib]: https://github.com/open-telemetry/opentelemetry-collector-releases/tree/main/distributions/otelcol-contrib
<!-- end autogenerated section -->

NATS Core exporter exports logs, metrics and traces to [NATS Core](https://docs.nats.io/).

# Configuration

The following configuration options are supported:

- `endpoint` (default = nats://localhost:4222): The NATS server URL.
- `tls`: See [TLS Configuration Settings](https://github.com/open-telemetry/opentelemetry-collector/blob/main/config/configtls/README.md) for the full set of available options.
- `logs`
  - `subject` (default = otel_logs): The [text/template](https://pkg.go.dev/text/template) template string used to construct NATS subjects for logs.
  - `marshaler` (default = otlp_proto): The name of the marshaler used to marshal logs. See [Supported Marshalers](#supported-marshalers).
  - `encoder`: The name of the encoding extension used to marshal logs. This configuration option is mutually exclusive with the `marshaler` configuration option. See [Encoding extensions](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/extension/encoding/README.md).
- `metrics`
  - `subject` (default = otel_metrics): The [text/template](https://pkg.go.dev/text/template) template string used to construct NATS subjects for metrics.
  - `marshaler` (default = otlp_proto): The name of the marshaler used to marshal metrics. See [Supported Marshalers](#supported-marshalers).
  - `encoder`: The name of the encoding extension used to marshal metrics. This configuration option is mutually exclusive with the `marshaler` configuration option. See [Encoding extensions](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/extension/encoding/README.md).
- `traces`
  - `subject` (default = otel_traces): The [text/template](https://pkg.go.dev/text/template) template string used to construct NATS subjects for traces.
  - `marshaler` (default = otlp_proto): The name of the marshaler used to marshal traces. See [Supported Marshalers](#supported-marshalers).
  - `encoder`: The name of the encoding extension used to marshal traces. This configuration option is mutually exclusive with the `marshaler` configuration option. See [Encoding extensions](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/extension/encoding/README.md).
- `auth`
  - `token`: The plaintext token used for [token auth](https://docs.nats.io/running-a-nats-service/configuration/securing_nats/auth_intro/tokens).
  - `username`: The username used for [username/password auth](https://docs.nats.io/running-a-nats-service/configuration/securing_nats/auth_intro/username_password).
  - `password`: The password used for [username/password auth](https://docs.nats.io/running-a-nats-service/configuration/securing_nats/auth_intro/username_password).
  - `nkey`: The public key used for [NKey auth](https://docs.nats.io/running-a-nats-service/configuration/securing_nats/auth_intro/nkey_auth).
  - `seed`: The seed used for [NKey auth](https://docs.nats.io/running-a-nats-service/configuration/securing_nats/auth_intro/nkey_auth).
  - `jwt`: The JWT used for [decentralized NKey auth (JWT auth)](https://docs.nats.io/running-a-nats-service/configuration/securing_nats/auth_intro/jwt).

## Supported marshalers

NATS Core exporter supports marshalers for the following built-in encodings:

- `otlp_proto`: Signals are encoded as OTLP Protobuf.
- `otlp_json`: Signals are encoded as OTLP JSON.
- `log_body`: Log bodies are extracted from logs and plaintext encoded. **This marshaler is only supported for logs.**

# Example Configurations

Example configurations showcasing notable configuration options.

## Dynamic subjects

Messages in NATS are routed using [subject-based filtering](https://docs.nats.io/nats-concepts/subjects#subject-based-filtering-and-security). To support this model, NATS Core exporter constructs dynamic subjects using [text/template](https://pkg.go.dev/text/template) template strings.

Below is an example of dynamic subjects for traces, where the configured template is executed on a [`Span`](https://pkg.go.dev/go.opentelemetry.io/collector/pdata/internal/data/protogen/trace/v1#Span):

```yaml
natscoreexporter:
  traces:
    subject: "otel.traces.{{ .TraceID }}.spans.{{ .SpanID }}"
```

## NKey auth

[NKey auth](https://docs.nats.io/running-a-nats-service/configuration/securing_nats/auth_intro/nkey_auth) can be used by NATS servers to authenticate clients without ever storing or seeing private keys.

Below is an example of NKey auth based on the [NATS Docs Client Configuration example](https://docs.nats.io/running-a-nats-service/configuration/securing_nats/auth_intro/nkey_auth#client-configuration):

```yaml
natscoreexporter:
  auth:
    nkey: "UDXU4RCSJNZOIQHZNWXHXORDPRTGNJAHAHFRGZNEEJCPQTT2M7NLCNF4"
    seed: "SUACSSL3UAHUDXKFSNVUZRF5UHPMWZ6BFDTJ7M6USDXIEDNPPQYYYCU3VY"
```

## Decentralized NKey auth (JWT auth)

Basic NKey auth requires a public key to be centrally stored in the NATS server configuration. NATS supports [using JWTs](https://docs.nats.io/running-a-nats-service/configuration/securing_nats/auth_intro/jwt) for decentralized NKey auth.

Below is an example of NKey auth using JWTs:

```yaml
natscoreexporter:
  auth:
    nkey: "eyJ0eXAiOiJKV1QiLCJhbGciOiJlZDI1NTE5LW5rZXkifQ.eyJqdGkiOiJWR0c3TUZFRFRCSkYzQkhGQ0tTNUdCWkpRMlNBVFFPTVNYM1hQU00ySTROV0FJNkpLNE1BIiwiaWF0IjoxNzU1ODI1NDIxLCJpc3MiOiJBQUZBU0lZV1dQSVFSQ1pPMk9YVVIyMlpKRE5SQlpEUjU2Nk5BR09LTUQ2RkNHU1RQWVRJU1VJSCIsIm5hbWUiOiJkdW1teSIsInN1YiI6IlVENEk2Wlo3UjZST0ZRT0tMNEFZWFdKNlRCVldXWFk0T1ZLR0w0UFozN0hWUTNWNFJQUFNUUFhMIiwibmF0cyI6eyJwdWIiOnt9LCJzdWIiOnt9LCJzdWJzIjotMSwiZGF0YSI6LTEsInBheWxvYWQiOi0xLCJ0eXBlIjoidXNlciIsInZlcnNpb24iOjJ9fQ.oiNbwJUDSA8ue65iSAuzlohw4qKlVWU9mhdyZhmvCbweEL5Q1jVesoB2BZ5a76M37iJA5GDWHHaGKfbObmeJCQ"
    seed: "SUACSSL3UAHUDXKFSNVUZRF5UHPMWZ6BFDTJ7M6USDXIEDNPPQYYYCU3VY"
```
